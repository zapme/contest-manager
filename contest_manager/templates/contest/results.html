{% extends 'base.html' %}

{% block title %}Submitted Logs | {{ contest['name'] }}{% endblock %}

{% block header %}
<h1>{{ contest['name'] }}</h1>

{% include 'contest/contest_nav.html' %}
{% endblock %}

{% block content %}
<!-- If there is a date to release results AND it's in the past AND there are results, show tables -->
{% if contest['results_date']
        and contest['results_date'] > utcnow
        and results != None
        and results|length > 0 %}
{% for cat in results|groupby('category') %}
    <h3>{{ cat.grouper }}</h3>
    <table class="table">
        <thead>
        <tr>
            <th>Place</th>
            <th>Callsign</th>
            <th>Name</th>
            <th>Operators</th>
            <th>Station</th>
            <th>Contest Club</th>
            <th>Score</th>
        <tr>
        </thead>
        <tbody>
        <!-- TODO: need results schema (use uploads table?) -->
        {% for entry in cat.list|sort(attribute='score', reverse=True) %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ entry.callsign }}</td>
                <td>{{ entry.name }}</td>
                <td>{{ entry.operator_callsigns }}</td>
                <td>{{ entry.station_callsign }}</td>
                <td>{{ entry.club_name }}</td>
                <td>{{ entry.score }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endfor %}

<h2>Overlays</h2>
{% for cat in results|groupby('category_overlay') %}
    <h3>{{ cat.grouper }}</h3>
    <table class="table">
        <thead>
        <tr>
            <th>Place</th>
            <th>Callsign</th>
            <th>Name</th>
            <th>Operators</th>
            <th>Station</th>
            <th>Contest Club</th>
            <th>Score</th>
        <tr>
        </thead>
        <tbody>
        <!-- TODO: need results schema (use uploads table?) -->
        {% for entry in cat.list|sort(attribute='score', reverse=True) %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ entry.callsign }}</td>
                <td>{{ entry.name }}</td>
                <td>{{ entry.operator_callsigns }}</td>
                <td>{{ entry.station_callsign }}</td>
                <td>{{ entry.club_name }}</td>
                <td>{{ entry.score }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endfor %}
{% else %}
    <h4>Results are not available yet!</h4>
    <h5 class="text-muted">Check back soon.</h5>
{% endif %}
{% endblock %}

